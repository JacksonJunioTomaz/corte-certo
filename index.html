<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Corte Certo - Agenda</title>
<style>
  body { font-family: Arial; padding: 20px; }
  #horarios button { margin: 5px; padding: 10px; }
  .agendamento { margin-top: 10px; padding: 5px; border: 1px solid #ccc; }
</style>
</head>
<body>
<h1>Corte Certo - Agenda</h1>

<label>Data: <input type="date" id="data"></label><br><br>

<div id="horarios"></div>

<h2>Agendamentos do Dia</h2>
<div id="lista"></div>

<script>
// --- Gerar horários 08:00 às 22:00, 30 em 30 min
function gerarHorarios() {
  const div = document.getElementById('horarios');
  div.innerHTML = '';

  let hora = 8;
  let minuto = 0;
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  while(hora < 22 || (hora === 22 && minuto === 0)) {
    let horaStr = hora.toString().padStart(2,'0');
    let minStr = minuto.toString().padStart(2,'0');
    let horario = `${horaStr}:${minStr}`;

    const btn = document.createElement('button');
    btn.textContent = horario;

    // Bloquear horário ocupado
    if(salvos.find(a => a.horario === horario)) {
      btn.disabled = true;
      btn.textContent += " (Ocupado)";
    }

    btn.onclick = () => agendarHorario(horario);

    div.appendChild(btn);
    div.appendChild(document.createElement('br'));

    minuto += 30;
    if(minuto === 60) { minuto = 0; hora++; }
  }
}

// --- Agendamento do cliente
function agendarHorario(horario) {
  const cliente = prompt("Nome do cliente:");
  if(!cliente) return alert("Nome obrigatório.");

  const servico = prompt("Serviço (ex: Corte Certo 39,90):");
  if(!servico) return alert("Serviço obrigatório.");

  const pagamento = prompt("Pagamento (Pix, Cartão ou Dinheiro no local):");
  if(!pagamento) return alert("Forma de pagamento obrigatória.");

  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  salvos.push({horario, cliente, servico, pagamento});
  localStorage.setItem(chave, JSON.stringify(salvos));

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Listar agendamentos e botão cancelar
function listarAgendamentos(lista) {
  const div = document.getElementById('lista');
  div.innerHTML = '';

  lista.forEach((a, index) => {
    const item = document.createElement('div');
    item.className = 'agendamento';
    item.innerHTML = `
      <strong>${a.horario}</strong><br>
      ${a.cliente}<br>
      ${a.servico}<br>
      ${a.pagamento}<br>
      <button onclick="cancelarAgendamento(${index})">Cancelar</button>
    `;
    div.appendChild(item);
  });
}

// --- Cancelar agendamento
function cancelarAgendamento(index) {
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  if(!confirm("Deseja realmente cancelar este agendamento?")) return;

  salvos.splice(index, 1);
  localStorage.setItem(chave, JSON.stringify(salvos));

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Atualizar ao mudar a data
document.getElementById('data').addEventListener('change', () => {
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];
  listarAgendamentos(salvos);
  gerarHorarios();
});

// --- Inicializar com data de hoje
document.getElementById('data').value = new Date().toISOString().split('T')[0];
const chaveHoje = 'barbearia_' + document.getElementById('data').value;
listarAgendamentos(JSON.parse(localStorage.getItem(chaveHoje)) || []);
gerarHorarios();
</script>

</body>
</html>


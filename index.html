<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Corte Certo - Agenda</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 500px; margin:auto; }
  h1,h2,h3 { text-align: center; }
  #horarios button { width: 100%; font-size: 18px; padding: 12px; margin:5px 0; }
  .agendamento { margin-top: 10px; padding: 5px; border: 1px solid #ccc; }
  #formulario { border: 1px solid #888; padding: 10px; margin-top: 20px; }
  label { display:block; margin:5px 0; }
  input, select { width: 100%; padding: 5px; margin-top: 3px; }
  button { cursor: pointer; }
</style>
</head>
<body>

<h1>Corte Certo - Agenda</h1>

<label>Data: <input type="date" id="data"></label>

<div id="horarios"></div>

<div id="formulario">
  <h3>Agendar horário</h3>
  <label>Horário:
    <input type="text" id="horarioSelecionado" readonly>
  </label>
  <label>Nome:
    <input type="text" id="nomeCliente">
  </label>
  <label>Serviço:
    <input type="text" id="servicoCliente" value="Corte Certo 39,90">
  </label>
  <label>Pagamento:
    <select id="pagamentoCliente">
      <option value="Pix">Pix</option>
      <option value="Cartão">Cartão</option>
      <option value="Dinheiro">Dinheiro no local</option>
    </select>
  </label>
  <button onclick="salvarAgendamento()">Salvar</button>
  <button onclick="cancelarFormulario()">Cancelar</button>
</div>

<h2>Agendamentos do Dia</h2>
<div id="lista"></div>

<script>
let horarioAtual = '';

// --- Gerar horários 08:00 às 22:00
function gerarHorarios() {
  const div = document.getElementById('horarios');
  div.innerHTML = '';

  let hora = 8;
  let minuto = 0;
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  while(hora < 22 || (hora === 22 && minuto === 0)) {
    let horaStr = hora.toString().padStart(2,'0');
    let minStr = minuto.toString().padStart(2,'0');
    let horario = `${horaStr}:${minStr}`;

    const btn = document.createElement('button');
    btn.textContent = horario;

    // Bloquear horário ocupado
    if(salvos.find(a => a.horario === horario)) {
      btn.disabled = true;
      btn.textContent += " (Ocupado)";
    }

    btn.onclick = () => agendarHorario(horario);

    div.appendChild(btn);

    minuto += 30;
    if(minuto === 60){ minuto = 0; hora++; }
  }
}

// --- Abrir formulário ao selecionar horário
function agendarHorario(horario){
  document.getElementById('horarioSelecionado').value = horario;
  document.getElementById('nomeCliente').focus();
}

// --- Cancelar formulário
function cancelarFormulario(){
  document.getElementById('horarioSelecionado').value = '';
  document.getElementById('nomeCliente').value = '';
  document.getElementById('servicoCliente').value = 'Corte Certo 39,90';
  document.getElementById('pagamentoCliente').value = 'Pix';
}

// --- Salvar agendamento
function salvarAgendamento(){
  const cliente = document.getElementById('nomeCliente').value.trim();
  const servico = document.getElementById('servicoCliente').value.trim();
  const pagamento = document.getElementById('pagamentoCliente').value;
  const horario = document.getElementById('horarioSelecionado').value;

  if(!horario){ return alert("Selecione um horário"); }
  if(!cliente){ return alert("Nome obrigatório"); }
  if(!servico){ return alert("Serviço obrigatório"); }

  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  salvos.push({horario, cliente, servico, pagamento});
  localStorage.setItem(chave, JSON.stringify(salvos));

  cancelarFormulario();
  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Listar agendamentos
function listarAgendamentos(lista){
  const div = document.getElementById('lista');
  div.innerHTML = '';

  lista.forEach((a,index)=>{
    const item = document.createElement('div');
    item.className = 'agendamento';
    item.innerHTML = `
      <strong>${a.horario}</strong><br>
      ${a.cliente}<br>
      ${a.servico}<br>
      ${a.pagamento}<br>
      <button onclick="cancelarAgendamento(${index})">Cancelar</button>
    `;
    div.appendChild(item);
  });
}

// --- Cancelar agendamento
function cancelarAgendamento(index){
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  if(!confirm("Deseja realmente cancelar este agendamento?")) return;

  salvos.splice(index,1);
  localStorage.setItem(chave, JSON.stringify(salvos));

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Atualizar ao mudar a data
document.getElementById('data').addEventListener('change',()=>{
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];
  listarAgendamentos(salvos);
  gerarHorarios();
});

// --- Inicializar com data de hoje
document.getElementById('data').value = new Date().toISOString().split('T')[0];
const chaveHoje = 'barbearia_' + document.getElementById('data').value;
listarAgendamentos(JSON.parse(localStorage.getItem(chaveHoje)) || []);
gerarHorarios();
</script>

</body>
</html>

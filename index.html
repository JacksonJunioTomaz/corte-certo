<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Corte Certo - Agenda</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 500px;
    margin: auto;
    background: linear-gradient(to bottom, #f8c291, #f6e58d);
    color: #222;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
  }

  h1,h2,h3 { text-align: center; }

  #oferta {
    text-align:center;
    margin-bottom:15px;
    padding:10px;
    background-color:#f1c40f;
    border-radius:8px;
    font-weight:bold;
  }

  #horarios button {
    width: 100%;
    font-size: 18px;
    padding: 12px;
    margin:5px 0;
    background-color: #f39c12;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
  }

  #horarios button:disabled {
    background-color: #ccc;
    color: #666;
    cursor: not-allowed;
  }

  .agendamento {
    margin-top: 10px;
    padding: 8px;
    border: 1px solid #888;
    border-radius: 6px;
    background-color: rgba(255,255,255,0.9);
  }

  #formulario {
    border: 1px solid #888;
    padding: 10px;
    margin-top: 20px;
    background-color: rgba(255,255,255,0.95);
    border-radius: 8px;
  }

  label { display:block; margin:5px 0; }
  input, select { width: 100%; padding: 6px; margin-top: 3px; border-radius: 4px; border:1px solid #aaa; }

  button { cursor: pointer; }
</style>
</head>
<body>

<h1>Corte Certo - Agenda</h1>

<div id="oferta">
游꿀 Oferta de Fundador: 20 primeiras vagas!<br>
Pre칞o: R$39,90
</div>

<label>Data: <input type="date" id="data"></label>

<div id="horarios"></div>

<div id="formulario">
  <h3>Agendar hor치rio</h3>
  <label>Hor치rio:
    <input type="text" id="horarioSelecionado" readonly>
  </label>
  <label>Nome:
    <input type="text" id="nomeCliente">
  </label>
  <label>Servi칞o:
    <select id="servicoCliente">
      <option value="Corte Certo 39,90">Corte Certo 39,90</option>
      <option value="Teste Gr치tis">Teste Gr치tis</option>
    </select>
  </label>
  <label>Pagamento:
    <select id="pagamentoCliente">
      <option value="Pix">Pix</option>
      <option value="Cart칚o">Cart칚o</option>
      <option value="Dinheiro">Dinheiro no local</option>
    </select>
  </label>
  <button onclick="salvarAgendamento()">Salvar</button>
  <button onclick="cancelarFormulario()">Cancelar</button>
</div>

<h2>Agendamentos do Dia</h2>
<div id="lista"></div>

<script>
let horarioAtual = '';
const limiteFundador = 20; // 20 primeiras vagas
const limiteTeste = 5; // 5 testes gr치tis por dia

// --- Gerar hor치rios 08:00 맙 22:00
function gerarHorarios() {
  const div = document.getElementById('horarios');
  div.innerHTML = '';

  let hora = 8;
  let minuto = 0;
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  // Contar quantos agendamentos Fundador j치 existem
  const totalFundador = salvos.filter(a => a.servico === "Corte Certo 39,90").length;

  // Atualizar oferta de fundador se esgotou
  if(totalFundador >= limiteFundador){
    document.getElementById('oferta').textContent = "Oferta de Fundador esgotada! Pre칞o normal: R$39,90";
  }

  while(hora < 22 || (hora === 22 && minuto === 0)) {
    let horaStr = hora.toString().padStart(2,'0');
    let minStr = minuto.toString().padStart(2,'0');
    let horario = `${horaStr}:${minStr}`;

    const btn = document.createElement('button');
    btn.textContent = horario;

    // Bloquear hor치rio ocupado
    if(salvos.find(a => a.horario === horario)) {
      btn.disabled = true;
      btn.textContent += " (Ocupado)";
    }

    btn.onclick = () => agendarHorario(horario);

    div.appendChild(btn);

    minuto += 30;
    if(minuto === 60){ minuto = 0; hora++; }
  }
}

// --- Abrir formul치rio ao selecionar hor치rio
function agendarHorario(horario){
  document.getElementById('horarioSelecionado').value = horario;
  document.getElementById('nomeCliente').focus();
}

// --- Cancelar formul치rio
function cancelarFormulario(){
  document.getElementById('horarioSelecionado').value = '';
  document.getElementById('nomeCliente').value = '';
  document.getElementById('servicoCliente').value = 'Corte Certo 39,90';
  document.getElementById('pagamentoCliente').value = 'Pix';
}

// --- Salvar agendamento
function salvarAgendamento(){
  const cliente = document.getElementById('nomeCliente').value.trim();
  const servico = document.getElementById('servicoCliente').value;
  const pagamento = document.getElementById('pagamentoCliente').value;
  const horario = document.getElementById('horarioSelecionado').value;

  if(!horario){ return alert("Selecione um hor치rio"); }
  if(!cliente){ return alert("Nome obrigat칩rio"); }

  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  // Limite Teste Gr치tis
  if(servico === "Teste Gr치tis"){
    const totalTeste = salvos.filter(a => a.servico === "Teste Gr치tis").length;
    if(totalTeste >= limiteTeste){
      return alert("Desculpe, todos os testes gr치tis do dia j치 foram agendados.");
    }
  }

  // Limite Fundador
  if(servico === "Corte Certo 39,90"){
    const totalFundador = salvos.filter(a => a.servico === "Corte Certo 39,90").length;
    if(totalFundador >= limiteFundador){
      alert("Oferta de Fundador esgotada! Voc칡 estar치 pagando pre칞o normal.");
    }
  }

  salvos.push({horario, cliente, servico, pagamento});
  localStorage.setItem(chave, JSON.stringify(salvos));

  cancelarFormulario();
  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Listar agendamentos
function listarAgendamentos(lista){
  const div = document.getElementById('lista');
  div.innerHTML = '';

  lista.forEach((a,index)=>{
    const item = document.createElement('div');
    item.className = 'agendamento';
    item.innerHTML = `
      <strong>${a.horario}</strong><br>
      ${a.cliente}<br>
      ${a.servico}<br>
      ${a.pagamento}<br>
      <button onclick="cancelarAgendamento(${index})">Cancelar</button>
    `;
    div.appendChild(item);
  });
}

// --- Cancelar agendamento
function cancelarAgendamento(index){
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  if(!confirm("Deseja realmente cancelar este agendamento?")) return;

  salvos.splice(index,1);
  localStorage.setItem(chave, JSON.stringify(salvos));

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Atualizar ao mudar a data
document.getElementById('data').addEventListener('change',()=>{
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];
  listarAgendamentos(salvos);
  gerarHorarios();
});

// --- Inicializar com data de hoje
document.getElementById('data').value = new Date().toISOString().split('T')[0];
const chaveHoje = 'barbearia_' + document.getElementById('data').value;
listarAgendamentos(JSON.parse(localStorage.getItem(chaveHoje)) || []);
gerarHorarios();
</script>

</body>
</html>

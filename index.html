<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Corte Certo - Agenda</title>
<style>
  body { font-family: Arial; padding: 20px; }
  #horarios button { margin: 5px; padding: 10px; width: 100px; }
  .agendamento { margin-top: 10px; padding: 5px; border: 1px solid #ccc; }
  #formulario { border: 1px solid #888; padding: 10px; margin-top: 10px; display:none; }
  label { display:block; margin:5px 0; }
</style>
</head>
<body>
<h1>Corte Certo - Agenda</h1>

<label>Data: <input type="date" id="data"></label><br><br>

<div id="horarios"></div>

<div id="formulario">
  <h3>Agendar horário: <span id="horarioSelecionado"></span></h3>
  <label>Nome: <input type="text" id="nomeCliente"></label>
  <label>Serviço: <input type="text" id="servicoCliente" value="Corte Certo 39,90"></label>
  <label>Pagamento: 
    <select id="pagamentoCliente">
      <option value="Pix">Pix</option>
      <option value="Cartão">Cartão</option>
      <option value="Dinheiro">Dinheiro no local</option>
    </select>
  </label>
  <button onclick="salvarAgendamento()">Salvar</button>
  <button onclick="cancelarFormulario()">Cancelar</button>
</div>

<h2>Agendamentos do Dia</h2>
<div id="lista"></div>

<script>
let horarioAtual = '';

// --- Gerar horários 08:00 às 22:00
function gerarHorarios() {
  const div = document.getElementById('horarios');
  div.innerHTML = '';

  let hora = 8;
  let minuto = 0;
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  while(hora < 22 || (hora === 22 && minuto === 0)) {
    let horaStr = hora.toString().padStart(2,'0');
    let minStr = minuto.toString().padStart(2,'0');
    let horario = `${horaStr}:${minStr}`;

    const btn = document.createElement('button');
    btn.textContent = horario;

    // Bloquear horário ocupado
    if(salvos.find(a => a.horario === horario)) {
      btn.disabled = true;
      btn.textContent += " (Ocupado)";
    }

    btn.onclick = () => agendarHorario(horario);

    div.appendChild(btn);
    div.appendChild(document.createElement('br'));

    minuto += 30;
    if(minuto === 60){ minuto = 0; hora++; }
  }
}

// --- Abrir formulário para agendamento
function agendarHorario(horario){
  horarioAtual = horario;
  document.getElementById('horarioSelecionado').textContent = horario;
  document.getElementById('formulario').style.display = 'block';
}

// --- Cancelar formulário
function cancelarFormulario(){
  document.getElementById('formulario').style.display = 'none';
  horarioAtual = '';
  document.getElementById('nomeCliente').value = '';
}

// --- Salvar agendamento
function salvarAgendamento(){
  const cliente = document.getElementById('nomeCliente').value.trim();
  const servico = document.getElementById('servicoCliente').value.trim();
  const pagamento = document.getElementById('pagamentoCliente').value;

  if(!cliente) return alert("Nome obrigatório");

  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  salvos.push({horario: horarioAtual, cliente, servico, pagamento});
  localStorage.setItem(chave, JSON.stringify(salvos));

  document.getElementById('formulario').style.display = 'none';
  document.getElementById('nomeCliente').value = '';
  horarioAtual = '';

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Listar agendamentos
function listarAgendamentos(lista){
  const div = document.getElementById('lista');
  div.innerHTML = '';

  lista.forEach((a,index)=>{
    const item = document.createElement('div');
    item.className = 'agendamento';
    item.innerHTML = `
      <strong>${a.horario}</strong><br>
      ${a.cliente}<br>
      ${a.servico}<br>
      ${a.pagamento}<br>
      <button onclick="cancelarAgendamento(${index})">Cancelar</button>
    `;
    div.appendChild(item);
  });
}

// --- Cancelar agendamento
function cancelarAgendamento(index){
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];

  if(!confirm("Deseja realmente cancelar este agendamento?")) return;

  salvos.splice(index,1);
  localStorage.setItem(chave, JSON.stringify(salvos));

  listarAgendamentos(salvos);
  gerarHorarios();
}

// --- Atualizar ao mudar a data
document.getElementById('data').addEventListener('change',()=>{
  const data = document.getElementById('data').value || new Date().toISOString().split('T')[0];
  const chave = 'barbearia_' + data;
  const salvos = JSON.parse(localStorage.getItem(chave)) || [];
  listarAgendamentos(salvos);
  gerarHorarios();
});

// --- Inicializar com data de hoje
document.getElementById('data').value = new Date().toISOString().split('T')[0];
const chaveHoje = 'barbearia_' + document.getElementById('data').value;
listarAgendamentos(JSON.parse(localStorage.getItem(chaveHoje)) || []);
gerarHorarios();
</script>

</body>
</html>
